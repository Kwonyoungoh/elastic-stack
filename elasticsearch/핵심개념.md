# 핵심 개념
> elasticsearch 7.2 버전 기준
## 목차
- [Data 구조](#data-구조)
- [색인과 역색인](#색인과-역색인)
- [노드의 종류](#노드의-종류)
- [클러스터, 노드, 샤드의 관계](#클러스터-노드-샤드의-관계)

## Data 구조
* index : 데이터의 저장 공간, 한 노드에 여러개의 논리적 index를 생성할 수 있음, 검색시 index 이름으로 document 데이터를 검색, 분산 환경 구축시 index는 여러 노드에 분산 저장된다.
* type : index의 논리적인 구조이다. ( 현재 버전에서는 사용 권장 안함 )
* Document : 최소 저장단위, 기본적으로 JSON 포멧, RDB의 ROW에 해당, 다수의 Field로 구성되어있으며 각 Field는 Data Type 정의 필요, 중첩 구조 지원(문서안의 문서) 
* Field : Document를 구성하기 위한 속성, 하나 이상의 Data Type을 갖을 수 있으며, RDB의 칼럼에 해당하지만 정적이지 않고 동적이다.
* 샤드 : 색인된 데이터는 하나의 index 포함된다. 이 때 데이터 손실 방지를 위해 나눠 저장하게 되는데 각 나눠지 파티션을 샤드라고 한다. 
* 매핑 : Document의 Field와 Field의 속성을 정의하고 그에 따른 색인 방법을 정의하는 프로세스, 매핑 정보에는 여러가지 데이터 타입을 지정할 수 있지만 필드명 중복은 안된다.

## 색인과 역색인
색인과 역색인의 목적은 데이터 검색의 성능 향상을 위해 검색 가능한 구조로 가공하는 것이다.
* 색인 : 데이터에서 검색에 필요한 키워드를 추출해 내는 과정\
(ex) input : 나는 박정웅이다. 색인 output : ['나는', '박정웅', '박정웅이다.']

* 역색인 : 키워드에 해당하는 문서의 위치를 매핑하는 과정\
(ex) input : 나는 박정웅이다., 나는 누구인가? 역색인 output : { key : '박정웅' value : ['나는 박정웅이다.의 문서 위치'], key : '나는', value : ['나는 .. 의 문서 위치', '나는 누구 .. 의 문서 위치']}

## 노드의 종류
처리 데이터가 적은 환경에선느 마스터와 데이터 역활을 같이 하도록 설정해도됨

* 마스터 노드 : 클러스터 관리, 인덱스 생성, 삭제, 등 전반적인 작업 관리, 네트워크 속도가 빠른 노드가 유리함, 클러스터 내 다수의 마스터 노드를 지정하여도 내부 선출 로직에 따라 1개만 마스터 역활을 함
* 데이터 노드 : 데이터의 저장, 검색, 통계,등 작업 관리, H/W 성능이 노드가 유리함
* 코디네디팅 노드 : 요청을 라운드로빈 방식으로 다른 노드에 요청함, 마스터, 데이터 역활은 하지 않음
* 인제스트 노드 : 색인에 앞서 데이터의 전처리 작업만 담당

## 클러스터, 노드, 샤드의 관계
* 클러스터 : 모든 노드의 검색과 색인 작업을 관장하는 논리적 단위, 클러스터와 클러스터간의 연결 구성도 가능
* 노드 : elasticsearch 프로세스를 말하며 보통 하나의 물리서버에 1개의 elasticsearch 프로세스, 기본적으로 마스터 노드가 전체적인 클러스터 관리, 데이터 노드가 실제 데이터 관리
* 클러스터 환경에서 샤드\
클러스터 환경에서 각 노드는 설정된 샤드값에 따라 index를 분산 하여 저장한다.\
샤드값이 3, 노드의 개수가 3개일 경우 1개의 index는 3개로 분할되어 각각의 노드에 저장된다.

* 프라이머리 샤드와 레프리카 샤드 : 프라이머리 샤드는 노드에서 사용하는 샤드를 말하며, 레프리카 샤드는 다른 노드에 있는 프라이머리 샤드의 복사본이다.\
다른 노드의 플라이머리 샤드의 복사본(레프리카 샤드)를 갖고 있기 때문에 다른 노드에 장애발생시 데이터를 복구 할 수 있다.
