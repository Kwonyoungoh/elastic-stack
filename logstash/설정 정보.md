# Logstash 필수 설정

> 테스트 환경 정보 Logstash 7.2, elasticsearch 7.2, centos 7

## 목차
- [설정파일 종류](#설정파일-종류)
- [입출력 설정](#입출력-설정)
- [파이프라인 설정](#)-작성중
- [grok 필터](#)-작성중
- [로그 설정](#)-작성중
- [보안 설정](#보안-설정)

## 설정파일 종류
> logstash홈/config/ \
전체 내용은 [여기](https://www.elastic.co/guide/en/logstash/current/config-setting-files.html) 참고
- logstash.yml\
대부분의 옵션과 커맨드 라인으로 입력 받는 명령어를 이 파일에 작성한 내용으로 실행할 수 있음, 커맨드 라인에 입력되는게 있으면 파일 내용은 후순위로 동작

- pipelines.yml\
로그스태쉬의 멀티 파이프 라인 동작에 대한 설정

- jvm.option\
jvm 옵션 설정

- log4j2.propertie\
로그 설정

- startup.options\
실행시 유저 그룹, 서비스 이름, 등에 대한 설정

## 입출력 설정
- logstash.yml에 설정 파일 지정
    ```
    vi logstash홈/config/logstash.yml
    path.config: logstash홈/config/ifoConf.yml
    ```
- 입출력 설정
    ```
    vi logstash홈/config/ifoConf.yml
    #입력 설정
    input { stdin { } }
    
    #필터 설정
    filter {}
    
    #출력 설정  
    output { stdout {} }
    ```
    입력이 filebeat 출력이 elasticsearch 예시
    ```
    #입력 설정
    input { beat { port => "5044"} }
    
    #출력 설정  
    output { 
        elasticsearch {
            hosts => ["localhostL9200"]
        } 
    }
    ```
    다른 예제는 [여기](https://www.elastic.co/guide/en/logstash/current/config-examples.html) 참고

    
- 보안 설정
    * 로그 스태쉬 계정 정보 생성
    ```
    POST _xpack/security/role/logstash_writer
    {
      "cluster": ["manage_index_templates", "monitor", "manage_ilm"], 
      "indices": [
        {
          "names": [ "*" ], #names 필드는 각각의 환경에 따라 변경해줘야됨
          "privileges": ["write","delete","create_index","manage","manage_ilm"]  
        }
      ]
    }
    
    POST _xpack/security/user/logstash_internal
    {
      "password" : "x-pack-test-password",
      "roles" : [ "logstash_writer"],
      "full_name" : "Internal Logstash User"
    }
    
    ```
    kibana에서도 동일하기 가능 Management > Roles 메뉴에서 설정
    
    * output 설정
    ```
    logstash홈/config/ifoConf.yml
    
    ....
    #출력 설정  
    output { 
        elasticsearch {
            hosts => ["localhostL9200"]
            user => "logstash_writer"
            password => "x-pack-test-password"
        } 
    }
    ```